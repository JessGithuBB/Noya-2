{% extends "themes/base_admin.html.twig" %}

{% block title %}Nouvel Article{% endblock %}
{% block description %}Créer un nouvel article{% endblock %}

{% block main %}

<h1 class="text-center my-4 display-5">Création d'un article</h1>

<div class="mb-3 d-flex align-items-center">
    <img src="{{ asset('build/images/annuler.png') }}" alt="Retour" width="24" height="24" class="me-2">
    <h6 class="mb-0">
        <a href="{{ path('app_admin_articles_index') }}" class="text-decoration-none">
            <i class="bi bi-arrow-left-circle"></i> Revenir à la liste des articles
        </a>
    </h6>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-7 col-md-9 col-sm-12">
            {{ form_start(form) }}

            {# IMAGE PRINCIPALE #}
            <div class="mb-3">
                {{ form_label(form.imageFile, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.imageFile) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-image"></i></span>
                    {{ form_widget(form.imageFile, { 'attr': { 'class': 'form-control' } }) }}
                </div>
            </div>

            {# CODE #}
            <div class="mb-3">
                {{ form_label(form.code, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.code) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-hash"></i></span>
                    {{ form_widget(form.code, { 'attr': { 'class': 'form-control', 'placeholder': 'Code unique' } }) }}
                </div>
            </div>

            {# NAME #}
            <div class="mb-3">
                {{ form_label(form.name, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.name) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-tag"></i></span>
                    {{ form_widget(form.name, { 'attr': { 'class': 'form-control', 'placeholder': 'Nom de l\'article' } }) }}
                </div>
            </div>

            {# SLUG #}
            <div class="mb-3">
                {{ form_label(form.slug, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.slug) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                    {{ form_widget(form.slug, { 'attr': { 'class': 'form-control', 'placeholder': 'slug-url' } }) }}
                </div>
            </div>

            {# SHORT DESCRIPTION #}
            <div class="mb-3">
                {{ form_label(form.short_description, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.short_description) }}</div>
                {{ form_widget(form.short_description, { 'attr': { 'class': 'form-control', 'rows': 3, 'placeholder': 'Description courte' } }) }}
            </div>

            {# LONG DESCRIPTION #}
            <div class="mb-3">
                {{ form_label(form.long_description, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.long_description) }}</div>
                {{ form_widget(form.long_description, { 'attr': { 'class': 'form-control', 'rows': 5, 'placeholder': 'Description longue' } }) }}
            </div>

            {# BRAND #}
            <div class="mb-3">
                {{ form_label(form.brand, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.brand) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-building"></i></span>
                    {{ form_widget(form.brand, { 'attr': { 'class': 'form-control', 'placeholder': 'Marque' } }) }}
                </div>
            </div>

            {# SELLING PRICE #}
            <div class="mb-3">
                {{ form_label(form.selling_price, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.selling_price) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-currency-euro"></i></span>
                    {{ form_widget(form.selling_price, { 'attr': { 'class': 'form-control', 'placeholder': 'Prix de vente' } }) }}
                </div>
            </div>

            {# QUANTITY #}
            <div class="mb-3">
                {{ form_label(form.quantity, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.quantity) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-box-seam"></i></span>
                    {{ form_widget(form.quantity, { 'attr': { 'class': 'form-control', 'placeholder': 'Quantité disponible' } }) }}
                </div>
            </div>

            {# CHECKBOXES #}
            <div class="form-check mb-3">
                {{ form_widget(form.is_new_arrival, { 'attr': { 'class': 'form-check-input' } }) }}
                {{ form_label(form.is_new_arrival, null, { 'label_attr': {'class': 'form-check-label'} }) }}
            </div>

            <div class="form-check mb-3">
                {{ form_widget(form.is_best_seller, { 'attr': { 'class': 'form-check-input' } }) }}
                {{ form_label(form.is_best_seller, null, { 'label_attr': {'class': 'form-check-label'} }) }}
            </div>

            <div class="form-check mb-4">
                {{ form_widget(form.is_available, { 'attr': { 'class': 'form-check-input' } }) }}
                {{ form_label(form.is_available, null, { 'label_attr': {'class': 'form-check-label'} }) }}
            </div>

            {# IMAGES SUPPLÉMENTAIRES POUR CARROUSEL #}
            <h5 class="mt-4">Images supplémentaires :</h5>
            <div data-collection-holder data-limit="3">
                {{ form_widget(form.images) }}
            </div>

            {# CARROUSEL SI IMAGES EXISTANTES #}

                {% include 'components/carousel.html.twig' with { images: article.images } %}
                {% for imageForm in form.images %}
                    <div class="mb-3">
                        {{ form_label(imageForm.imageFile, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                        <div class="text-danger">{{ form_errors(imageForm.imageFile) }}</div>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-image"></i></span>
                            {{ form_widget(imageForm.imageFile, { 'attr': { 'class': 'form-control' } }) }}
                        </div>
                    </div>
                {% endfor %}
            {# MOTS-CLÉS #}
            <div class="mb-3">
                {{ form_label(form.keywordsText, null, { 'label_attr': {'class': 'form-label fw-bold'} }) }}
                {{ form_widget(form.keywordsText, { 'attr': {'class': 'form-control'} }) }}
                <small class="text-muted">Séparez les mots-clés avec des virgules.</small>
            </div>

            {# CATÉGORIES #}
            <div class="mb-3">
                {{ form_label(form.categories, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.categories) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-folder"></i></span>
                    {{ form_widget(form.categories, { 'attr': { 'class': 'form-select' } }) }}
                </div>
                <small class="text-muted">Maintenez Ctrl (ou Cmd) pour sélectionner plusieurs catégories.</small>
            </div>

            {# SOUS-CATÉGORIES #}
            <div class="mb-3">
                {{ form_label(form.ssCategories, null, { 'label_attr': { 'class': 'form-label fw-semibold' } }) }}
                <div class="text-danger">{{ form_errors(form.ssCategories) }}</div>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-folder2-open"></i></span>
                    {{ form_widget(form.ssCategories, { 'attr': { 'class': 'form-select' } }) }}
                </div>
                <small class="text-muted">Maintenez Ctrl (ou Cmd) pour sélectionner plusieurs sous-catégories.</small>
            </div>

            {# BOUTON D'ENREGISTREMENT #}

            <button type="submit" class="btn btn-primary w-100 py-2 fs-5 fw-semibold mt-4">
                <i class="bi bi-check-circle me-2"></i> Enregistrer
            </button>

            {{ form_end(form) }}
        </div>
    </div>
</div>

{# Script pour filtrer les sous-catégories selon la catégorie sélectionnée #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const categoriesSelect = document.getElementById('article_categories');
    const sseCategoriesSelect = document.getElementById('article_ss_categories');
    
    if (categoriesSelect && sseCategoriesSelect) {
        // Sauvegarder toutes les options des sous-catégories
        const allSsCategories = Array.from(sseCategoriesSelect.options);
        
        // Fonction pour filtrer les sous-catégories
        function filterSsCategories() {
            const selectedCategories = Array.from(categoriesSelect.selectedOptions).map(option => option.text);
            
            // Si aucune catégorie n'est sélectionnée, afficher toutes les sous-catégories
            if (selectedCategories.length === 0) {
                sseCategoriesSelect.innerHTML = '';
                allSsCategories.forEach(option => {
                    sseCategoriesSelect.appendChild(option.cloneNode(true));
                });
                return;
            }
            
            // Filtrer et afficher uniquement les sous-catégories pertinentes
            // Note: Cette fonctionnalité nécessite que les sous-catégories aient un attribut data-category
            // Pour l'instant, nous laissons toutes les options visibles
            // Vous pouvez améliorer cette fonction en ajoutant un attribut data-category dans le formulaire
        }
        
        // Écouter les changements sur la sélection de catégories
        categoriesSelect.addEventListener('change', filterSsCategories);
    }
});
</script>
{% endblock %}
